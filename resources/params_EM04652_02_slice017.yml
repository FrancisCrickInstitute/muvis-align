general:
  show_original: False
  metadata_summary: False
  chunk_size: [4096, 4096]
  break_on_error: True
  logging:
    filename: log/muvis-align-EM04652.log
    format: '%(asctime)s %(levelname)s: %(message)s'
    dask: True
    time: True
    verbose: True
  output:
    clear: False
    overwrite: True
    format: ome.zarr
    tile_size: [4096, 4096]
    compression:
    npyramid_add: 4
    pyramid_downsample: 2
    thumbnail: ome.tiff
    thumbnail_scale: 1um

operations:
  - operation: register match s
    input: /nemo/project/proj-mrc-mm/raw/em/EM04652/EM04652_02_slice017/EM04652-02_slice17_spaghettiandmeatballs2/**/*.ome.tif
    #input: D:/slides/EM04652-02_slice17_spaghettiandmeatballs2/**/*_s00500.ome.tif
    #input: D:/slides/EM04652-02_slice17_spaghettiandmeatballs2/**/*_s00012.ome.tif
    source_metadata: sbem
    gaussian_sigma: 0.5
    #use_orthogonal_pairs: True
    transform_type: translation
    #method: phase_correlation
    method:
      name: sift
      max_keypoints: 5000
      inlier_threshold_factor: 0.05
      max_trials: 1000
      ransac_iterations: 3
    fusion: exclusive
    output_spacing: min
    n_parallel_pairwise_regs: 64
    output: ../../stitched/slice{s}/

  - operation: stack
    input: /nemo/project/proj-mrc-mm/raw/em/EM04652/EM04652_02_slice017/EM04652-02_slice17_spaghettiandmeatballs2/stitched/slice*/registered.ome.zarr
    #input: D:/slides/EM04652-02_slice17_spaghettiandmeatballs2/stitched/slice*/registered.ome.zarr
    #source_metadata: source
    source_metadata: {position: {y: 0, x: 0}, rotation: null}
    extra_metadata: {scale: {z: 0.05}}
    #scale: 0.04um
    gaussian_sigma: 2.5
    transform_type: affine
    #method: phase_correlation
    method:
      name: orb
      max_keypoints: 5000
      inlier_threshold_factor: 0.05
      max_trials: 1000
      ransac_iterations: 3
    output_spacing: min
    n_parallel_pairwise_regs: 64
    output: ../../aligned/
