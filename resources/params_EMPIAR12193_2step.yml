general:
  show_original: False
  metadata_summary: False
  chunk_size: [4096, 4096]
  break_on_error: True
  debug: True
  logging:
    filename: log/muvis-align-empiar12193.log
    format: '%(asctime)s %(levelname)s: %(message)s'
    dask: True
    time: True
    verbose: True
  output:
    clear: False
    overwrite: False
    format: ome.zarr
    tile_size: [4096, 4096]
    compression:
    npyramid_add: 4
    pyramid_downsample: 2
    thumbnail: ome.zarr

operations:
#  - operation: register match S
#    #input: /nemo/project/proj-ccp-vem/datasets/12193/data/S???/*.tiff
#    input: D:/slides/12193/data_subset/S???/*.tiff
#    source_metadata: {'scale': {'x': 0.004, 'y': 0.004}, 'position': {'y':'fn[-3]*24', 'x':'fn[-2]*24'}}
#    flatfield_quantiles: [0.5]
#    use_orthogonal_pairs: True
#    transform_type: translation
#    scale: 4
#    method:
#      name: sift
#      gaussian_sigma: 2
#      inlier_threshold_factor: 0.05
#      max_trials: 1000
#      ransac_iterations: 3
#    output: ../../stitched/S{S}/
#
#  - operation: stack
#    #input: /nemo/project/proj-ccp-vem/datasets/12193/stitched/S???/registered.ome.zarr
#    input: D:/slides/12193/stitched/S???/registered.ome.zarr
#    source_metadata: source
#    extra_metadata: {'scale': {'z': 0.1}}
#    transform_type: rigid
#    scale: 2
#    method:
#      name: sift
#      nkeypoints: 10000
#      gaussian_sigma: 4
#      inlier_threshold_factor: 0.05
#      max_trials: 1000
#      ransac_iterations: 3
#    output: ../../aligned/
#    save_images: False

  - operation: register 3d
    #input: /nemo/project/proj-ccp-vem/datasets/12193/data/S???/*.tiff
    #input: D:/slides/12193/data_subset/S???/*.tiff
    input:
      - /nemo/project/proj-ccp-vem/datasets/12193/data/S000/*.tiff
      - /nemo/project/proj-ccp-vem/datasets/12193/data/S001/*.tiff
      - /nemo/project/proj-ccp-vem/datasets/12193/data/S002/*.tiff
    source_metadata: {'scale': {'x': 0.004, 'y': 0.004, 'z': 1}, 'position': {'y':'fn[-3]*24', 'x':'fn[-2]*24', 'z':'S*1'}}
    extra_metadata: /nemo/project/proj-ccp-vem/datasets/12193/aligned_stitched_mappings2.json
    flatfield_quantiles: [0.5]
    use_orthogonal_pairs: False
    transform_type: rigid
    method:
      name: sift  # 3din2d
      nkeypoints: 10000
      gaussian_sigma: 2
      inlier_threshold_factor: 0.05
      max_trials: 1000
      ransac_iterations: 3
    output: ../../aligned2/
